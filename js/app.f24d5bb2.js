(function(e){function t(t){for(var r,s,a=t[0],c=t[1],u=t[2],d=0,m=[];d<a.length;d++)s=a[d],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&m.push(i[s][0]),i[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(m.length)m.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(r=!1)}r&&(o.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},i={app:0},o=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";n("85ec")},"0782":function(e,t,n){},1:function(e,t){},2:function(e,t){},3:function(e,t){},3017:function(e,t,n){},4:function(e,t){},5:function(e,t){},"52a5":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("99af");var r,i=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},s=[],a={name:"App",data:function(){return{}},components:{},sockets:{},computed:{}},c=a,u=(n("034f"),n("2877")),l=Object(u["a"])(c,o,s,!1,null,null,null),d=l.exports,m=(n("b0c0"),n("8c4f")),f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",["idle"==e.screen?n("div",[n("idle")],1):"match"==e.screen?n("div",[n("match")],1):"result"==e.screen?n("div",[n("result")],1):e._e()])},v=[],h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"about"},[n("h1",[e._v("Match")]),0!=e.counter?n("h2",[e._v(e._s(e.counter))]):e._e(),0!=e.counter||e.turn?e._e():n("div",["buttons"==e.mode?n("div",[n("button",{on:{click:function(t){return e.makeTurn("rock")}}},[e._v("Rock")]),n("button",{on:{click:function(t){return e.makeTurn("paper")}}},[e._v("Paper")]),n("button",{on:{click:function(t){return e.makeTurn("scissors")}}},[e._v("Scissors")])]):e._e(),"gesture"==e.mode?n("gesture",{on:{gesture:e.makeTurn}}):e._e(),"speech"==e.mode?n("speech",{on:{word:e.makeTurn}}):e._e()],1),e.turn?n("div",[n("div",[e._v("Your choice: "+e._s(e.turn))]),n("div",[e._v("Waiting for opponent...")])]):e._e()])},p=[],b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{attrs:{id:"center-container"}},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.videoDevice,expression:"videoDevice"}],attrs:{id:"camera-select"},on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.videoDevice=t.target.multiple?n:n[0]},function(t){return e.initWebcamStream()}]}},e._l(e.devices,(function(t){return n("option",{key:t.deviceId,domProps:{value:t.deviceId}},[e._v(" "+e._s(t.label)+" ")])})),0),n("div",{attrs:{id:"result-frame"}},[n("video",{ref:"video"})]),n("div",{staticClass:"table-container"},[n("table",{staticClass:"table"},e._l(e.predictions,(function(t,r){return n("tr",{key:r},[n("td",[n("label",{attrs:{for:t.name}},[e._v(e._s(t.name))])]),n("td",[n("meter",{staticClass:"score",attrs:{id:t.name,value:t.score,min:"0",max:"100"}})])])})),0)])])])},g=[],_=n("b85c"),w=(n("4de4"),n("d3b7"),n("a434"),n("159b"),n("b680"),n("0b53")),k=n("080e"),y={name:"App",components:{},data:function(){return{videoDevice:"",resultWidth:0,resultHeight:0,devices:[],baseModel:"mobilenet_v2",isModelReady:!1,predictions:[],lastPrediction:""}},mounted:function(){var e=this;w["setBackend"]("webgl"),this.listVideoDevices().then((function(t){var n,r=Object(_["a"])(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.devices.push(i)}}catch(o){r.e(o)}finally{r.f()}e.videoDevice=t[0].deviceId})).then((function(){return e.initWebcamStream()})).then((function(){return e.loadModel().then((function(){e.detectObjects()}))}))},beforeDestroy:function(){if(this.raf){var e=this.$refs.video;e.pause(),e.srcObject=null,this.isVideoStreamReady=!1,cancelAnimationFrame(this.raf)}},methods:{listVideoDevices:function(){return navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"videoinput"===e.kind}))}))},initWebcamStream:function(){var e=this;if(this.isVideoStreamReady=!1,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia({video:{deviceId:this.videoDevice}}).then((function(t){var n=e.$refs.video;return n.srcObject=t,new Promise((function(t){n.onloadedmetadata=function(){e.videoRatio=n.videoHeight/n.videoWidth,window.addEventListener("resize",e.setResultSize),e.setResultSize(),e.isVideoStreamReady=!0,n.play(),t()}}))})).catch((function(e){console.log("failed to initialize webcam stream",e)}))},setResultSize:function(){var e=document.documentElement.clientWidth;this.resultWidth=Math.min(600,e),this.resultHeight=this.resultWidth*this.videoRatio;var t=this.$refs.video;t.width=this.resultWidth,t.height=this.resultHeight},loadModel:function(){var e=this;return k["load"]("/gesture/model.json","/gesture/metadata.json").then((function(t){e.model=t,e.isModelReady=!0})).catch((function(e){throw console.log("failed to load the mode",e),e}))},detectObjects:function(){var e=this;this.isModelReady&&(this.isVideoStreamReady?this.model.predict(this.$refs.video).then((function(t){e.handlePredictions(t),e.raf=requestAnimationFrame((function(){e.detectObjects()}))})):this.raf=requestAnimationFrame((function(){e.detectObjects()})))},handlePredictions:function(e){var t,n=this;this.predictions.splice(0);var r=0;e.forEach((function(e){n.predictions.push({name:e.className,score:(100*e.probability).toFixed(1)}),e.probability>r&&(r=e.probability,t=e)})),this.lastPrediction!=t.className&&(this.lastPrediction=t.className,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((function(){"Nothing"!=n.lastPrediction&&n.$emit("gesture",n.lastPrediction.toLowerCase())}),500))}}},O=y,R=(n("aeb3"),Object(u["a"])(O,b,g,!1,null,null,null)),j=R.exports,M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app"},[n("div",{staticClass:"center-container"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.audioDevice,expression:"audioDevice"}],staticClass:"margin-10 device-select",on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.audioDevice=t.target.multiple?n:n[0]}}},e._l(e.audioDevices,(function(t,r){return n("option",{key:r,domProps:{value:t.deviceId}},[e._v(" "+e._s(t.label)+" ")])})),0),n("table",{staticClass:"margin-10"},[null!=e.topPrediction?n("tr",{staticClass:"top-row"},[n("td",[e._v(e._s(e.topPrediction.name))]),n("td",[e._v(e._s(e.topPrediction.score)+" %")])]):n("tr",[n("td",[e._v("Not sure...")])]),e._l(e.filteredSortedPredictions,(function(t,r){return n("tr",{key:r,staticClass:"other-rows"},[n("td",[e._v(e._s(t.name))]),n("td",[e._v(e._s(t.score)+" %")])])}))],2)])])},P=[],x=n("1da1"),E=n("2909"),D=(n("96cf"),n("af3e")),$={name:"App",data:function(){return{isModelReady:!1,predictions:[],audioTrackConstraints:{},audioDevices:[],audioDevice:""}},watch:{audioDevice:function(e){this.recognizer&&this.setupRecognizer(e)}},computed:{sortedPredictions:function(){var e=Object(E["a"])(this.predictions);return e.sort((function(e,t){return t.score-e.score})),e},topPrediction:function(){return this.sortedPredictions.length>0?this.sortedPredictions[0]:null},filteredSortedPredictions:function(){var e=this.topPrediction;return this.sortedPredictions.filter((function(t){return t!=e}))}},mounted:function(){var e=this;return Object(x["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:w["setBackend"]("webgl"),n=navigator.mediaDevices.enumerateDevices(),n.then(function(){var t=Object(x["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.forEach((function(t){"audioinput"===t.kind&&e.audioDevices.push(t)})),e.audioDevice=e.audioDevices[0].deviceId,t.next=4,e.createModel();case 4:e.recognizer=t.sent,e.classLabels=e.recognizer.wordLabels(),e.setupRecognizer(e.audioDevice);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 3:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){this.recognizer&&this.recognizer.stopListening()},methods:{setupRecognizer:function(e){var t=this;return Object(x["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.recognizer.isListening()){n.next=3;break}return n.next=3,t.recognizer.stopListening();case 3:return n.next=5,t.recognizer.listen((function(e){t.handlePredictions(e.scores)}),{includeSpectrogram:!1,probabilityThreshold:.75,invokeCallbackOnNoiseAndUnknown:!0,overlapFactor:.5,audioTrackConstraints:{deviceId:e}});case 5:case"end":return n.stop()}}),n)})))()},createModel:function(){return Object(x["a"])(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t="".concat(location.protocol,"//").concat(location.host),n="".concat(t,"/speech/model.json"),r="".concat(t,"/speech/metadata.json"),i=D["a"]("BROWSER_FFT",void 0,n,r),e.next=6,i.ensureModelLoaded();case 6:return e.abrupt("return",i);case 7:case"end":return e.stop()}}),e)})))()},handlePredictions:function(e){var t=this;this.predictions.length=0,e.forEach((function(e,n){t.predictions.push({name:t.classLabels[n],score:(100*e).toFixed(1)})}));var n=this.topPrediction;"Background Noise"!==n.name&&this.$emit("word",n.name.toLowerCase())}}},S=$,T=(n("ca8a"),Object(u["a"])(S,M,P,!1,null,null,null)),C=T.exports,A={components:{Gesture:j,Speech:C},data:function(){return{counter:3}},mounted:function(){var e=this,t=setInterval((function(){e.counter--,0==e.counter&&clearInterval(t)}),1e3)},methods:{makeTurn:function(e){this.$store.dispatch("makeTurn",{turn:e})}},computed:{turn:function(){return this.$store.state.turn},mode:function(){return this.$store.state.mode}}},L=A,q=Object(u["a"])(L,h,p,!1,null,null,null),N=q.exports,z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("button",{on:{click:e.logout}},[e._v("Logout")]),n("h2",[e._v("Available users")]),n("ul",e._l(e.users,(function(t,r){return n("li",{key:r,style:e.userColor(t),on:{click:function(n){return e.requestMatch(t)}}},[n("span",[e._v(e._s(t.username))]),t.matchRequest==e.user.username?n("span",[e._v(e._s(t.username)+" wants to play with you")]):n("span",[e._v("No match request")])])})),0)])},I=[],W={name:"Home",methods:{requestMatch:function(e){this.$store.dispatch("requestMatch",e)},userColor:function(e){return e.matchRequest==this.user.username?{backgroundColor:"rgba(200,50,50,0.4)"}:this.$store.state.matchRequest&&this.$store.state.matchRequest.username==e.username?{backgroundColor:"rgba(50,200,50,0.4)"}:void 0},logout:function(){this.$store.dispatch("logout")}},computed:{users:function(){var e=this;return this.$store.state.users.filter((function(t){return t.username!==e.user.username})).filter((function(e){return 0==e.inMatch}))},user:function(){return this.$store.state.user}}},U=W,H=(n("b990"),Object(u["a"])(U,z,I,!1,null,"a0655ed6",null)),F=H.exports,G=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"about"},[n("h1",[e._v("Result")]),e.result.winner?n("div",[e._v(e._s(e.result.winner.username)+" wins!")]):e._e(),null==e.result.winner?n("div",[e._v("Draw!")]):e._e(),n("table",e._l(e.result.players,(function(t,r){return n("tr",{key:r},[n("td",[e._v(e._s(t.username))]),n("td",[e._v(e._s(t.turn))])])})),0),n("button",{on:{click:e.newMatch}},[e._v("Start a new match")])])},V=[],B={methods:{newMatch:function(){this.$store.dispatch("newMatch")}},computed:{result:function(){return this.$store.state.result}}},Y=B,J=Object(u["a"])(Y,G,V,!1,null,null,null),K=J.exports,Q={name:"Game",components:{Match:N,Idle:F,Result:K},computed:{screen:function(){return this.$store.state.screen}}},X=Q,Z=(n("b787"),Object(u["a"])(X,f,v,!1,null,"beed3f82",null)),ee=Z.exports,te=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h2",[e._v("Choose interaction mode")]),n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.mode,expression:"mode"}],attrs:{type:"radio",id:"buttons",value:"buttons"},domProps:{checked:e._q(e.mode,"buttons")},on:{change:function(t){e.mode="buttons"}}}),n("label",{attrs:{for:"buttons"}},[e._v("Buttons")]),n("br"),n("input",{directives:[{name:"model",rawName:"v-model",value:e.mode,expression:"mode"}],attrs:{type:"radio",id:"gesture",value:"gesture"},domProps:{checked:e._q(e.mode,"gesture")},on:{change:function(t){e.mode="gesture"}}}),n("label",{attrs:{for:"gesture"}},[e._v("Gesture")]),n("br"),n("input",{directives:[{name:"model",rawName:"v-model",value:e.mode,expression:"mode"}],attrs:{type:"radio",id:"speech",value:"speech"},domProps:{checked:e._q(e.mode,"speech")},on:{change:function(t){e.mode="speech"}}}),n("label",{attrs:{for:"speech"}},[e._v("Speech")])]),n("div",{staticClass:"input"},[e._v(" Enter a username: "),n("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.username,expression:"username",modifiers:{trim:!0}}],staticClass:"username",attrs:{type:"text",name:"username",placeholder:"Username"},domProps:{value:e.username},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enterGame(t)},input:function(t){t.target.composing||(e.username=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})]),e.userExists?n("div",[e._v(" Username already taken ")]):e._e(),n("div",[n("button",{on:{click:e.enterGame}},[e._v("Enter game")])])])},ne=[],re={name:"Login",data:function(){return{username:""}},methods:{enterGame:function(){""!=this.username&&this.$store.dispatch("login",this.username)}},computed:{userExists:function(){return this.$store.state.invalidUser},mode:{get:function(){return this.$store.state.mode},set:function(e){this.$store.dispatch("setMode",e)}}}},ie=re,oe=(n("7e51"),Object(u["a"])(ie,te,ne,!1,null,"f1c4b764",null)),se=oe.exports,ae=n("ade3"),ce=n("2f62"),ue=n("0e44"),le="LOGIN_PLAYER",de="LOGOUT_PLAYER",me="PLAYER_EXISTS",fe="UPDATE_PLAYERS",ve="START_MATCH",he="MAKE_TURN",pe="MATCH_REQUESTED",be="END_MATCH",ge="NEW_MATCH",_e="SET_MODE";i["a"].use(ce["a"]);var we=new ce["a"].Store({plugins:[Object(ue["a"])()],state:{user:null,users:[],screen:"login",invalidUser:!1,inMatchWith:null,winner:null,matchRequest:null,turn:null,mode:"buttons",result:null},mutations:(r={},Object(ae["a"])(r,le,(function(e,t){e.user=t,e.screen="idle",e.invalidUser=!1,e.inMatchWith=null,e.matchRequest=null,e.turn=null})),Object(ae["a"])(r,de,(function(e){e.user=null})),Object(ae["a"])(r,me,(function(e){e.invalidUser=!0})),Object(ae["a"])(r,fe,(function(e,t){e.users=t})),Object(ae["a"])(r,ve,(function(e,t){e.inMatchWith=t,e.matchRequest=null,e.screen="match"})),Object(ae["a"])(r,he,(function(e,t){e.turn=t.turn})),Object(ae["a"])(r,be,(function(e,t){e.result=t,e.screen="result"})),Object(ae["a"])(r,ge,(function(e){e.winner=null,e.turn=null,e.result=null,e.screen="idle"})),Object(ae["a"])(r,pe,(function(e,t){e.matchRequest=t})),Object(ae["a"])(r,_e,(function(e,t){e.mode=t})),r),actions:{login:function(e,t){this.socket.emit("login",t)},logout:function(e){var t=e.state;this.socket.emit("logout",t.user.username)},requestMatch:function(e,t){var n=e.commit;n(pe,t),this.socket.emit("requestMatch",{opponent:t})},makeTurn:function(e,t){var n=e.commit;n(he,t),this.socket.emit("makeTurn",{turn:t})},newMatch:function(e){var t=e.commit;t(ge),this.socket.emit("newMatch")},setMode:function(e,t){var n=e.commit;n(_e,t)},socket_userLoggedIn:function(e,t){var n=e.commit;n(le,t),Re.push({name:"game"}).catch((function(){}))},socket_userExists:function(e){var t=e.commit;t(me)},socket_userLoggedOut:function(e,t){var n=e.commit;n(de,t),Re.push({name:"login"}).catch((function(){}))},socket_players:function(e,t){var n=e.commit;n(fe,t)},socket_startMatch:function(e,t){var n=e.commit;n(ve,t)},socket_matchResult:function(e,t){var n=e.commit;n(be,t)}},getters:{loggedIn:function(e){return null!==e.user},username:function(e){return e.user.username}}}),ke=we;i["a"].use(m["a"]);var ye=[{path:"/login",name:"login",component:se},{path:"/game",name:"game",component:ee}],Oe=new m["a"]({mode:"history",base:"/",routes:ye});Oe.beforeEach((function(e,t,n){ke.getters.loggedIn&&"login"==e.name?n("game"):ke.getters.loggedIn||"login"==e.name?n():n("login")}));var Re=Oe,je=n("5132"),Me=n.n(je),Pe=n("8e27"),xe=n.n(Pe),Ee="".concat(window.location.protocol,"//").concat(window.location.hostname,":8081");Ee="https://rps-server-.glitch.me/";var De=xe()(Ee,{});ke.socket=De,null!=ke.state.user&&ke.dispatch("login",ke.state.user.username);var $e=new Me.a({debug:!1,connection:De,vuex:{store:ke,actionPrefix:"socket_"}});i["a"].use($e),i["a"].config.productionTip=!1,new i["a"]({router:Re,store:ke,render:function(e){return e(d)}}).$mount("#app")},6:function(e,t){},7:function(e,t){},"7e51":function(e,t,n){"use strict";n("52a5")},"85ec":function(e,t,n){},"92c0":function(e,t,n){},aeb3:function(e,t,n){"use strict";n("92c0")},b787:function(e,t,n){"use strict";n("0782")},b990:function(e,t,n){"use strict";n("3017")},ca8a:function(e,t,n){"use strict";n("d02b")},d02b:function(e,t,n){}});
//# sourceMappingURL=app.f24d5bb2.js.map